name: Build Matrix (Multi-OS)

on:
  # 禁用此工作流，只使用 release-auto.yml
  workflow_dispatch:
    # 手动触发构建（仅用于测试）

jobs:
  build:
    strategy:
      matrix:
        os: [windows-latest]
        java-version: ['23']
        
    runs-on: ${{ matrix.os }}
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up JDK ${{ matrix.java-version }}
      uses: actions/setup-java@v4
      with:
        java-version: ${{ matrix.java-version }}
        distribution: 'temurin'
        cache: 'gradle'
        
    # Gradle 缓存已由 setup-java 的 cache: 'gradle' 自动处理
    # Windows 环境，不需要设置执行权限
      
    - name: Build with Gradle
      run: .\gradlew.bat clean build --no-daemon --stacktrace
      env:
        GRADLE_OPTS: "-Dfile.encoding=UTF-8"
      continue-on-error: false
        
    - name: Build fat JAR
      run: .\gradlew.bat fatJar --no-daemon --stacktrace
      env:
        GRADLE_OPTS: "-Dfile.encoding=UTF-8"
      continue-on-error: false
        
    - name: Upload JAR artifact
      uses: actions/upload-artifact@v4
      with:
        name: cloudsim-benchmark-${{ runner.os }}
        path: build/libs/cloudsim-benchmark-*.jar
        retention-days: 30

